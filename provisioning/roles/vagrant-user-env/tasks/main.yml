---
# vagrant-user-env / tasks / main

- name: Check if bash_it dir exists
  stat: path=/home/vagrant/.bash_it
  register: bash_it

- name: Git clone bash-it repo
  git:
    repo: "{{ bash_it_repo }}"
    version: "master"
    depth: 1
    dest: "~/.bash_it"
  become_user: vagrant
  become: yes
  ignore_errors: yes

# TODO: This should only run if not run before.
#       (do not yet know how to implement this check)
- name: Run bash-it installer
  command: "~/.bash_it/install.sh --silent"
  become_user: vagrant
  become: yes
  register: bash_it_installed
  when: bash_it.stat.exists == False

- name: Create build directory
  file:
    path: "~/build"
    state: directory
  become_user: vagrant
  become: yes

- name: Add vagrant to group docker
  user:
    name: vagrant
    groups: docker
  when: result_install_docker_packages is success

- name: Ensure direnv started in user .bashrc
  lineinfile: 
    path: /home/vagrant/.bashrc
    regexp: '^.*direnv hook bash.*$'
    line: 'eval "$(direnv hook bash)"'
    state: present
    owner: vagrant
    group: vagrant
    mode: 0644