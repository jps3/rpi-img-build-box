---
# common / tasks / main

- name: Install helpful {{ ansible_distribution }} packages.
  include_tasks: debian.yml
  when: ansible_distribution == 'Debian'

- name: Ensure timezone set to {{ local_timezone }}
  timezone:
    name: "{{ local_timezone }}"

- name: Ensure locale {{ local_locale }} exists
  locale_gen:
    name: "{{ local_locale }}"
    state: present

- name: Ensure keyboard defaults file uses correct model
  replace:
    path: /etc/default/keyboard
    regexp: '^(XKBMODEL)="[^"]*"'
    replace: '\1="pc104"'
  notify: regenerate keyboard-configuration

- name: Ensure keyboard defaults file uses correct layout
  replace:
    path: /etc/default/keyboard
    regexp: '^(XKBLAYOUT)="[^"]*"'
    replace: '\1="us"'
  notify: regenerate keyboard-configuration

- name: Partition information
  parted:
    device: /dev/vda
    number: 1
  register: partinfo

- set_fact:
  gap_kb: "{{ partinfo.disk.size - partinfo.partitions[0].end }}"

- debug: 'msg="Gap after partition 1: {{gap_kb}} KiB"'

